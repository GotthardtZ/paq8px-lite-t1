#ifndef PAQ8PX_UTF8_HPP
#define PAQ8PX_UTF8_HPP

#include <cstdint>
// UTF8 validator
// Based on: http://bjoern.hoehrmann.de/utf-8/decoder/dfa/
// Control characters (0x00-0x1f) and 0x7f are not allowed (except for 0/tab/cr/lf)

#define UTF_8_ACCEPT 0
#define UTF_8_REJECT 12

static const constexpr uint8_t utf8StateTable[] = {
        // byte -> character class
        // character_class = utf8StateTable[byte]
        1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, // 00..1f
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 20..3f
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, // 40..5f
        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, // 60..7f
        1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, // 80..9f
        7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, // a0..bf
        8, 8, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, // c0..df
        10, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 3, 3, 11, 6, 6, 6, 5, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, // e0..ff
        // validating automaton
        // new_state = utf8StateTable[256*old_state + character_class]
        0, 12, 24, 36, 60, 96, 84, 12, 12, 12, 48, 72, // state  0-11
        12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, // state 12-23
        12, 0, 12, 12, 12, 12, 12, 0, 12, 0, 12, 12, // state 24-35
        12, 24, 12, 12, 12, 12, 12, 24, 12, 24, 12, 12, // state 36-47
        12, 12, 12, 12, 12, 12, 12, 24, 12, 12, 12, 12, // state 48-59
        12, 24, 12, 12, 12, 12, 12, 12, 12, 24, 12, 12, // state 60-71
        12, 12, 12, 12, 12, 12, 12, 36, 12, 36, 12, 12, // state 72-83
        12, 36, 12, 12, 12, 12, 12, 36, 12, 36, 12, 12, // state 84-95
        12, 36, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12 // state 96-108
};


#endif //PAQ8PX_UTF8_HPP
